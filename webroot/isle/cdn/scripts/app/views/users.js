define(["jquery","../Util","../NodeManager"],function(e,t,n){e(function(){var r=new n,i={fieldNames:{id:"id",uid:"selUID",name:"hidName",email:"hidEmail",role:"selRole"},itemName:"user",order:[{col:"Role_name"},{col:"name"}],buildTable:function(n){var r="<thead><th></th><th>User</th><th>Role</th></thead><tbody>",i="";e.each(n.items,function(e,n){i='<a href="'+t.rootdir+"assets?item=user&value="+t.htmlEncode(n.uid)+'">'+t.htmlEncode(n.name)+"</a>",n["email"]!=null&&(i+=' <a href="mailto:'+t.htmlEncode(n.email)+'" aria-label="send email to user"><i class="icon-envelope"></i></a>'),r+='<tr><td><span role="button" tabindex="0" id="'+n.id+'" title="Edit"><i class="icon-edit"></i></span></td><td>'+i+"</td>",r+="<td>"+n.Role_name+"</td></tr>"}),r+="</tbody>",e("#nodeTable").html(r)},modalInit:function(){e("#toEmail").html(""),e("#labEmail").show(),e("#readOnlyUser").remove(),e("#modalDialog .ui-combobox").show()},fillForm:function(n,r,i){var s=e(i).attr("id"),o=t.getObjects(n.items,"id",s)[0],u=o.uid,a=o.name,f=o.email,l=o.role;e("#labEmail").hide(),e("#readOnlyUser").remove(),e('#modalDialog select[name="'+this.fieldNames.uid+'"]').after('<span id="readOnlyUser">'+t.htmlEncode(a)+"</span>"),e("#modalDialog .ui-combobox").hide(),e('#modalDialog input[name="'+this.fieldNames.id+'"]').val(s),e('#modalDialog select[name="'+this.fieldNames.uid+'"]').val(u),e('#modalDialog input[name="'+this.fieldNames.name+'"]').val(a),e('#modalDialog input[name="'+this.fieldNames.email+'"]').val(f),e('#modalDialog select[name="'+this.fieldNames.role+'"]').val(l),e("#modalDialog .ui-combobox input").val(a);if(u==e("html").attr("data-user"))return alert("You can't modify your own account. Have another administrator do it for you."),!1},duplicate:{field:"uid",errorMsg:"That user already exists"},firstFocus:"select"};r.initialize(i),e("#"+i.fieldNames.uid).combobox({selected:function(n,r){e("#"+i.fieldNames.name).val(e(r.item).html()),e("#"+i.fieldNames.email).val(e(r.item).attr("data-email")),e("#chkEmail").val(e(r.item).attr("data-email")),e("#toEmail").html("to "+t.htmlEncode(e(r.item).attr("data-email")))}})})})